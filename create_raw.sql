
CREATE SCHEMA IF NOT EXISTS raw; 

DROP TABLE IF EXISTS raw.outpatient_claims;
CREATE TABLE IF NOT EXISTS raw.outpatient_claims(
    desynpuf_id CHAR(16),
    clm_id CHAR(15),
    segment SMALLINT,
    clm_from_dt DATE,
    clm_thru_dt DATE,
    prvdr_num VARCHAR(6),
    clm_pmt_amt NUMERIC(12,2),
    nch_prmry_pyr_clm_pd_amt NUMERIC(12,2),
    at_physn_npi CHAR(10),
    op_physn_npi CHAR(10),
    ot_physn_npi CHAR(10),
    nch_bene_blood_ddctbl_lblty_am NUMERIC(12,2),
    icd9_dgns_cd_1 VARCHAR(5),
    icd9_dgns_cd_2 VARCHAR(5),
    icd9_dgns_cd_3 VARCHAR(5),
    icd9_dgns_cd_4 VARCHAR(5),
    icd9_dgns_cd_5 VARCHAR(5),
    icd9_dgns_cd_6 VARCHAR(5),
    icd9_dgns_cd_7 VARCHAR(5),
    icd9_dgns_cd_8 VARCHAR(5),
    icd9_dgns_cd_9 VARCHAR(5),
    icd9_dgns_cd_10 VARCHAR(5),
    icd9_prcdr_cd_1 VARCHAR(5),
    icd9_prcdr_cd_2 VARCHAR(5),
    icd9_prcdr_cd_3 VARCHAR(5),
    icd9_prcdr_cd_4 VARCHAR(5),
    icd9_prcdr_cd_5 VARCHAR(5),
    icd9_prcdr_cd_6 VARCHAR(5),
	nch_bene_ip_ddctbl_amt NUMERIC(12,2),
    nch_bene_pta_coinsrnc_am NUMERIC(12,2),
	admtng_icd9_dgns_cd VARCHAR(5),
    hcpcs_cd_1 CHAR(5),
    hcpcs_cd_2 CHAR(5),
    hcpcs_cd_3 CHAR(5),
    hcpcs_cd_4 CHAR(5),
    hcpcs_cd_5 CHAR(5),
    hcpcs_cd_6 CHAR(5),
    hcpcs_cd_7 CHAR(5),
    hcpcs_cd_8 CHAR(5),
    hcpcs_cd_9 CHAR(5),
    hcpcs_cd_10 CHAR(5),
    hcpcs_cd_11 CHAR(5),
    hcpcs_cd_12 CHAR(5),
    hcpcs_cd_13 CHAR(5),
    hcpcs_cd_14 CHAR(5),
    hcpcs_cd_15 CHAR(5),
    hcpcs_cd_16 CHAR(5),
    hcpcs_cd_17 CHAR(5),
    hcpcs_cd_18 CHAR(5),
    hcpcs_cd_19 CHAR(5),
    hcpcs_cd_20 CHAR(5),
    hcpcs_cd_21 CHAR(5),
    hcpcs_cd_22 CHAR(5),
    hcpcs_cd_23 CHAR(5),
    hcpcs_cd_24 CHAR(5),
    hcpcs_cd_25 CHAR(5),
    hcpcs_cd_26 CHAR(5),
    hcpcs_cd_27 CHAR(5),
    hcpcs_cd_28 CHAR(5),
    hcpcs_cd_29 CHAR(5),
    hcpcs_cd_30 CHAR(5),
    hcpcs_cd_31 CHAR(5),
    hcpcs_cd_32 CHAR(5),
    hcpcs_cd_33 CHAR(5),
    hcpcs_cd_34 CHAR(5),
    hcpcs_cd_35 CHAR(5),
    hcpcs_cd_36 CHAR(5),
    hcpcs_cd_37 CHAR(5),
    hcpcs_cd_38 CHAR(5),
    hcpcs_cd_39 CHAR(5),
    hcpcs_cd_40 CHAR(5),
    hcpcs_cd_41 CHAR(5),
    hcpcs_cd_42 CHAR(5),
    hcpcs_cd_43 CHAR(5),
    hcpcs_cd_44 CHAR(5),
    hcpcs_cd_45 CHAR(5)
)

DROP TABLE IF EXISTS raw.carrier_claims;
CREATE TABLE IF NOT EXISTS raw.carrier_claims (
    desynpuf_id        CHAR(16),
    clm_id             CHAR(15),
    clm_from_dt        DATE,
    clm_thru_dt        DATE,

    icd9_dgns_cd_1     VARCHAR(5),
    icd9_dgns_cd_2     VARCHAR(5),
    icd9_dgns_cd_3     VARCHAR(5),
    icd9_dgns_cd_4     VARCHAR(5),
    icd9_dgns_cd_5     VARCHAR(5),
    icd9_dgns_cd_6     VARCHAR(5),
    icd9_dgns_cd_7     VARCHAR(5),
    icd9_dgns_cd_8     VARCHAR(5),

    prf_physn_npi_1    CHAR(10),
    prf_physn_npi_2    CHAR(10),
    prf_physn_npi_3    CHAR(10),
    prf_physn_npi_4    CHAR(10),
    prf_physn_npi_5    CHAR(10),
    prf_physn_npi_6    CHAR(10),
    prf_physn_npi_7    CHAR(10),
    prf_physn_npi_8    CHAR(10),
    prf_physn_npi_9    CHAR(10),
    prf_physn_npi_10   CHAR(10),
    prf_physn_npi_11   CHAR(10),
    prf_physn_npi_12   CHAR(10),
    prf_physn_npi_13   CHAR(10),

    tax_num_1          CHAR(9),
    tax_num_2          CHAR(9),
    tax_num_3          CHAR(9),
    tax_num_4          CHAR(9),
    tax_num_5          CHAR(9),
    tax_num_6          CHAR(9),
    tax_num_7          CHAR(9),
    tax_num_8          CHAR(9),
    tax_num_9          CHAR(9),
    tax_num_10         CHAR(9),
    tax_num_11         CHAR(9),
    tax_num_12         CHAR(9),
    tax_num_13         CHAR(9),

    hcpcs_cd_1         CHAR(5),
    hcpcs_cd_2         CHAR(5),
    hcpcs_cd_3         CHAR(5),
    hcpcs_cd_4         CHAR(5),
    hcpcs_cd_5         CHAR(5),
    hcpcs_cd_6         CHAR(5),
    hcpcs_cd_7         CHAR(5),
    hcpcs_cd_8         CHAR(5),
    hcpcs_cd_9         CHAR(5),
    hcpcs_cd_10        CHAR(5),
    hcpcs_cd_11        CHAR(5),
    hcpcs_cd_12        CHAR(5),
    hcpcs_cd_13        CHAR(5),

    line_nch_pmt_amt_1    NUMERIC(12,2),
    line_nch_pmt_amt_2    NUMERIC(12,2),
    line_nch_pmt_amt_3    NUMERIC(12,2),
    line_nch_pmt_amt_4    NUMERIC(12,2),
    line_nch_pmt_amt_5    NUMERIC(12,2),
    line_nch_pmt_amt_6    NUMERIC(12,2),
    line_nch_pmt_amt_7    NUMERIC(12,2),
    line_nch_pmt_amt_8    NUMERIC(12,2),
    line_nch_pmt_amt_9    NUMERIC(12,2),
    line_nch_pmt_amt_10   NUMERIC(12,2),
    line_nch_pmt_amt_11   NUMERIC(12,2),
    line_nch_pmt_amt_12   NUMERIC(12,2),
    line_nch_pmt_amt_13   NUMERIC(12,2),

    line_bene_ptb_ddctbl_amt_1  NUMERIC(12,2),
    line_bene_ptb_ddctbl_amt_2  NUMERIC(12,2),
    line_bene_ptb_ddctbl_amt_3  NUMERIC(12,2),
    line_bene_ptb_ddctbl_amt_4  NUMERIC(12,2),
    line_bene_ptb_ddctbl_amt_5  NUMERIC(12,2),
    line_bene_ptb_ddctbl_amt_6  NUMERIC(12,2),
    line_bene_ptb_ddctbl_amt_7  NUMERIC(12,2),
    line_bene_ptb_ddctbl_amt_8  NUMERIC(12,2),
    line_bene_ptb_ddctbl_amt_9  NUMERIC(12,2),
    line_bene_ptb_ddctbl_amt_10 NUMERIC(12,2),
    line_bene_ptb_ddctbl_amt_11 NUMERIC(12,2),
    line_bene_ptb_ddctbl_amt_12 NUMERIC(12,2),
    line_bene_ptb_ddctbl_amt_13 NUMERIC(12,2),

    line_bene_prmry_pyr_pd_amt_1  NUMERIC(12,2),
    line_bene_prmry_pyr_pd_amt_2  NUMERIC(12,2),
    line_bene_prmry_pyr_pd_amt_3  NUMERIC(12,2),
    line_bene_prmry_pyr_pd_amt_4  NUMERIC(12,2),
    line_bene_prmry_pyr_pd_amt_5  NUMERIC(12,2),
    line_bene_prmry_pyr_pd_amt_6  NUMERIC(12,2),
    line_bene_prmry_pyr_pd_amt_7  NUMERIC(12,2),
    line_bene_prmry_pyr_pd_amt_8  NUMERIC(12,2),
    line_bene_prmry_pyr_pd_amt_9  NUMERIC(12,2),
    line_bene_prmry_pyr_pd_amt_10 NUMERIC(12,2),
    line_bene_prmry_pyr_pd_amt_11 NUMERIC(12,2),
    line_bene_prmry_pyr_pd_amt_12 NUMERIC(12,2),
    line_bene_prmry_pyr_pd_amt_13 NUMERIC(12,2),

    line_coinsrnc_amt_1   NUMERIC(12,2),
    line_coinsrnc_amt_2   NUMERIC(12,2),
    line_coinsrnc_amt_3   NUMERIC(12,2),
    line_coinsrnc_amt_4   NUMERIC(12,2),
    line_coinsrnc_amt_5   NUMERIC(12,2),
    line_coinsrnc_amt_6   NUMERIC(12,2),
    line_coinsrnc_amt_7   NUMERIC(12,2),
    line_coinsrnc_amt_8   NUMERIC(12,2),
    line_coinsrnc_amt_9   NUMERIC(12,2),
    line_coinsrnc_amt_10  NUMERIC(12,2),
    line_coinsrnc_amt_11  NUMERIC(12,2),
    line_coinsrnc_amt_12  NUMERIC(12,2),
    line_coinsrnc_amt_13  NUMERIC(12,2),

    line_alowd_chrg_amt_1   NUMERIC(12,2),
    line_alowd_chrg_amt_2   NUMERIC(12,2),
    line_alowd_chrg_amt_3   NUMERIC(12,2),
    line_alowd_chrg_amt_4   NUMERIC(12,2),
    line_alowd_chrg_amt_5   NUMERIC(12,2),
    line_alowd_chrg_amt_6   NUMERIC(12,2),
    line_alowd_chrg_amt_7   NUMERIC(12,2),
    line_alowd_chrg_amt_8   NUMERIC(12,2),
    line_alowd_chrg_amt_9   NUMERIC(12,2),
    line_alowd_chrg_amt_10  NUMERIC(12,2),
    line_alowd_chrg_amt_11  NUMERIC(12,2),
    line_alowd_chrg_amt_12  NUMERIC(12,2),
    line_alowd_chrg_amt_13  NUMERIC(12,2),

    line_prcsg_ind_cd_1   CHAR(1),
    line_prcsg_ind_cd_2   CHAR(1),
    line_prcsg_ind_cd_3   CHAR(1),
    line_prcsg_ind_cd_4   CHAR(1),
    line_prcsg_ind_cd_5   CHAR(1),
    line_prcsg_ind_cd_6   CHAR(1),
    line_prcsg_ind_cd_7   CHAR(1),
    line_prcsg_ind_cd_8   CHAR(1),
    line_prcsg_ind_cd_9   CHAR(1),
    line_prcsg_ind_cd_10  CHAR(1),
    line_prcsg_ind_cd_11  CHAR(1),
    line_prcsg_ind_cd_12  CHAR(1),
    line_prcsg_ind_cd_13  CHAR(1),

    line_icd9_dgns_cd_1   VARCHAR(5),
    line_icd9_dgns_cd_2   VARCHAR(5),
    line_icd9_dgns_cd_3   VARCHAR(5),
    line_icd9_dgns_cd_4   VARCHAR(5),
    line_icd9_dgns_cd_5   VARCHAR(5),
    line_icd9_dgns_cd_6   VARCHAR(5),
    line_icd9_dgns_cd_7   VARCHAR(5),
    line_icd9_dgns_cd_8   VARCHAR(5),
    line_icd9_dgns_cd_9   VARCHAR(5),
    line_icd9_dgns_cd_10  VARCHAR(5),
    line_icd9_dgns_cd_11  VARCHAR(5),
    line_icd9_dgns_cd_12  VARCHAR(5),
    line_icd9_dgns_cd_13  VARCHAR(5)
);
DROP TABLE IF EXISTS raw.beneficiaries_08;
-- create seperate table for each beneficary year since in different files
-- only for the purpose of this analysis
-- in a business context a year field could be made with python beforehand
CREATE TABLE IF NOT EXISTS raw.beneficiaries_08(
    desynpuf_id CHAR(16),
    bene_birth_dt DATE,
    bene_death_dt DATE,
    bene_sex_ident_cd SMALLINT,
    bene_race_cd SMALLINT,
    bene_esrd_ind CHAR(1),
    sp_state_code SMALLINT,
    bene_county_cd VARCHAR(3),
    bene_hi_cvrage_tot_mons SMALLINT,
    bene_smi_cvrage_tot_mons SMALLINT,
    bene_hmo_cvrage_tot_mons SMALLINT,
    plan_cvrg_mos_num SMALLINT,
    sp_alzhdmta SMALLINT,
    sp_chf SMALLINT,
    sp_chrnkidn SMALLINT,
    sp_cncr SMALLINT,
    sp_copd SMALLINT,
    sp_depressn SMALLINT,
    sp_diabetes SMALLINT,
    sp_ischmcht SMALLINT,
    sp_osteoprs SMALLINT,
    sp_ra_oa SMALLINT,
    sp_strketia SMALLINT,
    medreimb_ip NUMERIC(12,2),
    benres_ip NUMERIC(12,2),
    pp_pymt_ip NUMERIC(12,2),
    medreimb_op NUMERIC(12,2),
    benres_op NUMERIC(12,2),
    pp_pymt_op NUMERIC(12,2),
    medreimb_car NUMERIC(12,2),
    benres_car NUMERIC(12,2),
    pp_pymt_car NUMERIC(12,2)
);
DROP TABLE IF EXISTS raw.beneficiaries_09;
CREATE TABLE IF NOT EXISTS raw.beneficiaries_09(
    desynpuf_id CHAR(16),
    bene_birth_dt DATE,
    bene_death_dt DATE,
    bene_sex_ident_cd SMALLINT,
    bene_race_cd SMALLINT,
    bene_esrd_ind CHAR(1),
    sp_state_code SMALLINT,
    bene_county_cd VARCHAR(3),
    bene_hi_cvrage_tot_mons SMALLINT,
    bene_smi_cvrage_tot_mons SMALLINT,
    bene_hmo_cvrage_tot_mons SMALLINT,
    plan_cvrg_mos_num SMALLINT,
    sp_alzhdmta SMALLINT,
    sp_chf SMALLINT,
    sp_chrnkidn SMALLINT,
    sp_cncr SMALLINT,
    sp_copd SMALLINT,
    sp_depressn SMALLINT,
    sp_diabetes SMALLINT,
    sp_ischmcht SMALLINT,
    sp_osteoprs SMALLINT,
    sp_ra_oa SMALLINT,
    sp_strketia SMALLINT,
    medreimb_ip NUMERIC(12,2),
    benres_ip NUMERIC(12,2),
    pp_pymt_ip NUMERIC(12,2),
    medreimb_op NUMERIC(12,2),
    benres_op NUMERIC(12,2),
    pp_pymt_op NUMERIC(12,2),
    medreimb_car NUMERIC(12,2),
    benres_car NUMERIC(12,2),
    pp_pymt_car NUMERIC(12,2)
);
DROP TABLE IF EXISTS raw.beneficiaries_10;
CREATE TABLE IF NOT EXISTS raw.beneficiaries_10(
    desynpuf_id CHAR(16),
    bene_birth_dt DATE,
    bene_death_dt DATE,
    bene_sex_ident_cd SMALLINT,
    bene_race_cd SMALLINT,
    bene_esrd_ind CHAR(1),
    sp_state_code SMALLINT,
    bene_county_cd VARCHAR(3),
    bene_hi_cvrage_tot_mons SMALLINT,
    bene_smi_cvrage_tot_mons SMALLINT,
    bene_hmo_cvrage_tot_mons SMALLINT,
    plan_cvrg_mos_num SMALLINT,
    sp_alzhdmta SMALLINT,
    sp_chf SMALLINT,
    sp_chrnkidn SMALLINT,
    sp_cncr SMALLINT,
    sp_copd SMALLINT,
    sp_depressn SMALLINT,
    sp_diabetes SMALLINT,
    sp_ischmcht SMALLINT,
    sp_osteoprs SMALLINT,
    sp_ra_oa SMALLINT,
    sp_strketia SMALLINT,
    medreimb_ip NUMERIC(12,2),
    benres_ip NUMERIC(12,2),
    pp_pymt_ip NUMERIC(12,2),
    medreimb_op NUMERIC(12,2),
    benres_op NUMERIC(12,2),
    pp_pymt_op NUMERIC(12,2),
    medreimb_car NUMERIC(12,2),
    benres_car NUMERIC(12,2),
    pp_pymt_car NUMERIC(12,2)
);

DROP TABLE IF EXISTS raw.inpatient_claims;
CREATE TABLE IF NOT EXISTS raw.inpatient_claims (
    desynpuf_id CHAR(16),
    clm_id CHAR(15),
    segment SMALLINT,
    clm_from_dt DATE,
    clm_thru_dt DATE,
    prvdr_num VARCHAR(6),
    clm_pmt_amt NUMERIC(12,2),
    nch_prmry_pyr_clm_pd_amt NUMERIC(12,2),
    at_physn_npi CHAR(10),
    op_physn_npi CHAR(10),
    ot_physn_npi CHAR(10),
    clm_admsn_dt DATE,
    admtng_icd9_dgns_cd VARCHAR(10),
    clm_pass_thru_per_diem_amt NUMERIC(12,2),
    nch_bene_ip_ddctbl_amt NUMERIC(12,2),
    nch_bene_pta_coinsrnc_lblty_am NUMERIC(12,2),
    nch_bene_blood_ddctbl_lblty_am NUMERIC(12,2),
    clm_utlztn_day_cnt SMALLINT,
    nch_bene_dschrg_dt DATE,
    clm_drg_cd CHAR(8),
    icd9_dgns_cd_1 VARCHAR(5),
    icd9_dgns_cd_2 VARCHAR(5),
    icd9_dgns_cd_3 VARCHAR(5),
    icd9_dgns_cd_4 VARCHAR(5),
    icd9_dgns_cd_5 VARCHAR(5),
    icd9_dgns_cd_6 VARCHAR(5),
    icd9_dgns_cd_7 VARCHAR(5),
    icd9_dgns_cd_8 VARCHAR(5),
    icd9_dgns_cd_9 VARCHAR(5),
    icd9_dgns_cd_10 VARCHAR(5),
    icd9_prcdr_cd_1 VARCHAR(5),
    icd9_prcdr_cd_2 VARCHAR(5),
    icd9_prcdr_cd_3 VARCHAR(5),
    icd9_prcdr_cd_4 VARCHAR(5),
    icd9_prcdr_cd_5 VARCHAR(5),
    icd9_prcdr_cd_6 VARCHAR(5),
    hcpcs_cd_1 CHAR(5),
    hcpcs_cd_2 CHAR(5),
    hcpcs_cd_3 CHAR(5),
    hcpcs_cd_4 CHAR(5),
    hcpcs_cd_5 CHAR(5),
    hcpcs_cd_6 CHAR(5),
    hcpcs_cd_7 CHAR(5),
    hcpcs_cd_8 CHAR(5),
    hcpcs_cd_9 CHAR(5),
    hcpcs_cd_10 CHAR(5),
    hcpcs_cd_11 CHAR(5),
    hcpcs_cd_12 CHAR(5),
    hcpcs_cd_13 CHAR(5),
    hcpcs_cd_14 CHAR(5),
    hcpcs_cd_15 CHAR(5),
    hcpcs_cd_16 CHAR(5),
    hcpcs_cd_17 CHAR(5),
    hcpcs_cd_18 CHAR(5),
    hcpcs_cd_19 CHAR(5),
    hcpcs_cd_20 CHAR(5),
    hcpcs_cd_21 CHAR(5),
    hcpcs_cd_22 CHAR(5),
    hcpcs_cd_23 CHAR(5),
    hcpcs_cd_24 CHAR(5),
    hcpcs_cd_25 CHAR(5),
    hcpcs_cd_26 CHAR(5),
    hcpcs_cd_27 CHAR(5),
    hcpcs_cd_28 CHAR(5),
    hcpcs_cd_29 CHAR(5),
    hcpcs_cd_30 CHAR(5),
    hcpcs_cd_31 CHAR(5),
    hcpcs_cd_32 CHAR(5),
    hcpcs_cd_33 CHAR(5),
    hcpcs_cd_34 CHAR(5),
    hcpcs_cd_35 CHAR(5),
    hcpcs_cd_36 CHAR(5),
    hcpcs_cd_37 CHAR(5),
    hcpcs_cd_38 CHAR(5),
    hcpcs_cd_39 CHAR(5),
    hcpcs_cd_40 CHAR(5),
    hcpcs_cd_41 CHAR(5),
    hcpcs_cd_42 CHAR(5),
    hcpcs_cd_43 CHAR(5),
    hcpcs_cd_44 CHAR(5),
    hcpcs_cd_45 CHAR(5)
);
